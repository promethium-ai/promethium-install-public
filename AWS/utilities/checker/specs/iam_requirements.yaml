installer:
  simulate_actions:
    - iam:CreateRole
    - iam:AttachRolePolicy
    - iam:PutRolePolicy
    - iam:PassRole
    - iam:CreateInstanceProfile
    - iam:AddRoleToInstanceProfile
    - eks:*
    - ec2:*
    - elasticloadbalancing:*
    - autoscaling:*
    - ecr:*
    - acm:*
    - kms:*
    - s3:*
    - logs:*
    - glue:*
    - sts:AssumeRole

eks:
  cluster:
    trust_principals:
      - eks.amazonaws.com
    required_attached_suffixes: []
  worker:
    trust_principals:
      - ec2.amazonaws.com
    required_attached_suffixes:
      - eks-kms-access-policy
    actions:
      - kms:Encrypt
      - kms:Decrypt
      - kms:ReEncrypt*
      - kms:GenerateDataKey*
      - kms:DescribeKey
    forbidden_actions:
      - kms:CreateGrant
      - kms:ListGrants
      - kms:RevokeGrant

jumpbox:
  require_instance_profile: true

oidc:
  roles:
    lbcontroller:
      required_attached_suffixes:
        - lbcontroller-policy
      required_actions:
        - elasticloadbalancing:DescribeLoadBalancers
        - elasticloadbalancing:CreateLoadBalancer
        - elasticloadbalancing:CreateTargetGroup
        - elasticloadbalancing:CreateListener
        - elasticloadbalancing:ModifyLoadBalancerAttributes
        - ec2:DescribeSecurityGroups
        - ec2:CreateSecurityGroup
        - ec2:AuthorizeSecurityGroupIngress
        - ec2:CreateTags
        - iam:CreateServiceLinkedRole
      expected_subject_contains: aws-load-balancer-controller
    autoscaler:
      required_attached_suffixes:
        - eks-autoscaler-policy
      required_actions:
        - autoscaling:DescribeAutoScalingGroups
        - autoscaling:DescribeAutoScalingInstances
        - autoscaling:DescribeLaunchConfigurations
        - autoscaling:DescribeTags
        - autoscaling:SetDesiredCapacity
        - autoscaling:TerminateInstanceInAutoScalingGroup
        - ec2:DescribeInstanceTypes
        - ec2:DescribeLaunchTemplateVersions
      expected_subject_contains: cluster-autoscaler
    efs_csi_driver:
      required_attached_suffixes:
        - efs-csi-policy
      required_actions:
        - elasticfilesystem:DescribeAccessPoints
        - elasticfilesystem:DescribeFileSystems
        - elasticfilesystem:DescribeMountTargets
        - elasticfilesystem:CreateAccessPoint
        - elasticfilesystem:DeleteAccessPoint
        - ec2:DescribeAvailabilityZones
      expected_subject_contains: efs-csi-controller-sa
    ebs_csi_driver:
      required_attached_suffixes: []
      aws_managed_policies:
        - arn:aws:iam::aws:policy/service-role/AmazonEBSCSIDriverPolicy
      expected_subject_contains: ebs-csi-controller-sa
    pgbackup:
      required_attached_suffixes:
        - s3-access-policy
      required_actions:
        - s3:PutObject
        - s3:PutObjectAcl
        - s3:GetObject
        - s3:ListBucket
        - kms:Encrypt
        - kms:Decrypt
        - kms:ReEncrypt*
        - kms:GenerateDataKey*
        - kms:DescribeKey
      expected_subject_contains: pgbackup
    trino:
      required_attached_suffixes:
        - trino-glue-policy
      required_actions:
        - glue:GetDatabase
        - glue:GetDatabases
        - glue:GetTable
        - glue:GetTables
        - glue:GetPartition
        - glue:GetPartitions
        - s3:GetObject
        - s3:PutObject
        - s3:ListBucket
        - s3:DeleteObject
      expected_subject_contains: trino
